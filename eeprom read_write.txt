unsigned char writeEEData (unsigned char address, unsigned char data)
{
    unsigned char save_GIE;
    save_GIE = INTCONbits.GIE;
    EEADR = address; 
    EEDATA = data; 
    EECON1bits.EEPGD = 0;
    EECON1bits.WREN = 1;
    INTCONbits.GIE = 0;
    EECON2 = 0x55;
    EECON2 = 0xAA; // This is the required sequence
    EECON1bits.WR = 1;
    INTCONbits.GIE = save_GIE; 
    while (EECON1bits.WR); 
    EECON1bits.EEPGD = 1;
    EECON1bits.WREN = 0; 
    return EECON1bits.WRERR;
}

unsigned char readEEData (unsigned char address)
{
    unsigned char retval;
    unsigned char save_GIE;
    save_GIE = INTCONbits.GIE; 
    EEADR = address;
    EECON1bits.EEPGD = 0;
    EECON1bits.RD = 1;
    retval = EEDATA;
    EECON1bits.EEPGD = 1;
    return retval;
}